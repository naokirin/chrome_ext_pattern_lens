# 不足しているテストケース一覧

## normalization.test.js の不足テストケース

### 1. 記号の正規化（不足している記号）

既存テストでは「ー」と「／」のみテストされているが、実装には多くの記号マッピングがある。

#### ハイフン・ダッシュ系
- [ ] `－` (全角ハイフン) → `-`
- [ ] `—` (Em dash) → `-`
- [ ] `–` (En dash) → `-`
- [ ] `―` (Horizontal bar) → `-`

#### 句読点
- [ ] `：` (全角コロン) → `:`
- [ ] `；` (全角セミコロン) → `;`
- [ ] `，` (全角カンマ) → `,`
- [ ] `。` (全角句点) → `.`
- [ ] `．` (全角ピリオド) → `.`
- [ ] `、` (読点) → `,`
- [ ] `　` (全角スペース) → ` ` (半角スペース)

#### 括弧
- [ ] `（` (全角左括弧) → `(`
- [ ] `）` (全角右括弧) → `)`
- [ ] `［` (全角左角括弧) → `[`
- [ ] `］` (全角右角括弧) → `]`
- [ ] `｛` (全角左波括弧) → `{`
- [ ] `｝` (全角右波括弧) → `}`
- [ ] `＜` (全角小なり) → `<`
- [ ] `＞` (全角大なり) → `>`

#### 引用符
- [ ] `「` (左鍵括弧) → `"`
- [ ] `」` (右鍵括弧) → `"`
- [ ] `『` (左二重鍵括弧) → `"`
- [ ] `』` (右二重鍵括弧) → `"`
- [ ] `\uFF02` (全角引用符) → `"`
- [ ] `\uFF07` (全角アポストロフィ) → `'`
- [ ] `\u2018` (左シングル引用符) → `'`
- [ ] `\u2019` (右シングル引用符) → `'`
- [ ] `\u201C` (左ダブル引用符) → `"`
- [ ] `\u201D` (右ダブル引用符) → `"`

#### 数学記号・その他
- [ ] `＋` (全角プラス) → `+`
- [ ] `＝` (全角等号) → `=`
- [ ] `＊` (全角アスタリスク) → `*`
- [ ] `＃` (全角シャープ) → `#`
- [ ] `＄` (全角ドル) → `$`
- [ ] `％` (全角パーセント) → `%`
- [ ] `＆` (全角アンパサンド) → `&`
- [ ] `＠` (全角アットマーク) → `@`
- [ ] `＾` (全角サーカムフレックス) → `^`
- [ ] `｜` (全角縦線) → `|`
- [ ] `～` (全角チルダ) → `~`
- [ ] `＿` (全角アンダースコア) → `_`
- [ ] `！` (全角感嘆符) → `!`
- [ ] `？` (全角疑問符) → `?`
- [ ] `｀` (全角バッククォート) → `` ` ``

#### その他の記号
- [ ] `＼` (全角バックスラッシュ) → `\`

### 2. 濁点・半濁点の結合（不足しているケース）

既存テストでは基本的なケースのみ。実装には多くのマッピングがある。

#### 全角カタカナの濁点結合（不足）
- [ ] `キ゛` → `ギ`
- [ ] `ク゛` → `グ`
- [ ] `ケ゛` → `ゲ`
- [ ] `コ゛` → `ゴ`
- [ ] `サ゛` → `ザ`
- [ ] `シ゛` → `ジ`
- [ ] `ス゛` → `ズ`
- [ ] `セ゛` → `ゼ`
- [ ] `ソ゛` → `ゾ`
- [ ] `タ゛` → `ダ`
- [ ] `チ゛` → `ヂ`
- [ ] `ツ゛` → `ヅ`
- [ ] `テ゛` → `デ`
- [ ] `ト゛` → `ド`
- [ ] `ハ゛` → `バ`
- [ ] `ヒ゛` → `ビ`
- [ ] `フ゛` → `ブ`
- [ ] `ヘ゛` → `ベ`
- [ ] `ホ゛` → `ボ`
- [ ] `ヱ゛` → `ヹ`

#### 半角カタカナの濁点結合（不足）
- [ ] `ｷﾞ` → `ギ`
- [ ] `ｸﾞ` → `グ`
- [ ] `ｹﾞ` → `ゲ`
- [ ] `ｺﾞ` → `ゴ`
- [ ] `ｻﾞ` → `ザ`
- [ ] `ｼﾞ` → `ジ`
- [ ] `ｽﾞ` → `ズ`
- [ ] `ｾﾞ` → `ゼ`
- [ ] `ｿﾞ` → `ゾ`
- [ ] `ﾀﾞ` → `ダ`
- [ ] `ﾁﾞ` → `ヂ`
- [ ] `ﾂﾞ` → `ヅ`
- [ ] `ﾃﾞ` → `デ`
- [ ] `ﾄﾞ` → `ド`
- [ ] `ﾊﾞ` → `バ`
- [ ] `ﾋﾞ` → `ビ`
- [ ] `ﾌﾞ` → `ブ`
- [ ] `ﾍﾞ` → `ベ`
- [ ] `ﾎﾞ` → `ボ`
- [ ] `ｳﾞ` → `ヴ`

#### 半濁点結合（不足）
- [ ] `ハ゜` → `パ`
- [ ] `ヒ゜` → `ピ`
- [ ] `フ゜` → `プ`
- [ ] `ヘ゜` → `ペ`
- [ ] `ホ゜` → `ポ`
- [ ] `ﾊﾟ` → `パ`
- [ ] `ﾋﾟ` → `ピ`
- [ ] `ﾌﾟ` → `プ`
- [ ] `ﾍﾟ` → `ペ`
- [ ] `ﾎﾟ` → `ポ`

#### 小書き文字の濁点結合（不足）
- [ ] `ぁ゛` → `ぁ゙`
- [ ] `ぃ゛` → `ぃ゙`
- [ ] `ぇ゛` → `ぇ゙`
- [ ] `ぉ゛` → `ぉ゙`
- [ ] `ゃ゛` → `ゃ゙`
- [ ] `ゅ゛` → `ゅ゙`
- [ ] `ょ゛` → `ょ゙`
- [ ] `ゎ゛` → `ゎ゙`
- [ ] `ァ゛` → `ァ゙`
- [ ] `ィ゛` → `ィ゙`
- [ ] `ゥ゛` → `ゥ゙`
- [ ] `ェ゛` → `ェ゙`
- [ ] `ォ゛` → `ォ゙`
- [ ] `ャ゛` → `ャ゙`
- [ ] `ュ゛` → `ュ゙`
- [ ] `ョ゛` → `ョ゙`
- [ ] `ヮ゛` → `ヮ゙`

#### 古い仮名の濁点結合（不足）
- [ ] `ゐ゛` → `ゐ゙`
- [ ] `ゑ゛` → `ゑ゙`

### 3. カタカナの正規化（不足）⚠️ **カバレッジレポートで完全に未カバー**

**重要**: `normalizeFullWidthKatakana` 関数全体が未カバー（カバレッジ: 0%）。これは `normalizeSingleChar` の処理順序により、`normalizeKatakanaToHiragana` が先に実行されるため、この関数に到達していない。

**実装上の問題**: `normalizeSingleChar` では以下の順序で処理される:
1. `normalizeFullWidthAlphabet` 
2. `normalizeFullWidthNumbers`
3. `normalizeKatakanaToHiragana` ← **全角カタカナはここで処理される**
4. `normalizeFullWidthKatakana` ← **到達しない（フォールバックとして実装されているが使用されない）**

このため、`normalizeFullWidthKatakana` をテストするには、`normalizeKatakanaToHiragana` が `null` を返すケースを作る必要があるが、全角カタカナは常に `normalizeKatakanaToHiragana` で処理されるため、実質的に到達不可能。

**解決策の検討**:
- この関数が実際に使用されるケースがあるか確認
- 使用されない場合は削除を検討
- 使用される場合は、処理順序の見直しを検討

#### 全角カタカナ→半角カタカナ変換（normalizeFullWidthKatakana）
**注意**: この関数は `normalizeKatakanaToHiragana` の後に実行されるフォールバック処理。テストするには、`normalizeKatakanaToHiragana` が null を返すケースを作る必要がある。

- [ ] `ガ` → `ｶ` (濁点付きカタカナの処理)
- [ ] `ザ` → `ｻ`
- [ ] `ダ` → `ﾀ`
- [ ] `バ` → `ﾊ`
- [ ] `パ` → `ﾊ` (半濁点付きカタカナの処理)
- [ ] `ヴ` → `ｳ`
- [ ] `ヸ` → `ｳ`
- [ ] `ヹ` → `ｳ`
- [ ] `ゔ` → `ｳ`
- [ ] 全角カタカナの全文字種のテスト（マッピング内のすべての文字）

#### 特殊なカタカナの処理
- [ ] `ヲ` → `ｦ`
- [ ] `ッ` → `ｯ`
- [ ] `ャ` → `ｬ`
- [ ] `ュ` → `ｭ`
- [ ] `ョ` → `ｮ`
- [ ] `ー` → `ｰ` (長音記号)

### 4. 全角アルファベットの正規化（不足）⚠️ **カバレッジレポートで未カバー**

**重要**: 全角小文字アルファベット (`\uFF41-\uFF5A`) のブランチが完全に未カバー。

- [ ] 全角小文字アルファベット (`ａ`-`ｚ`) → 半角小文字 (`a`-`z`) **【未カバー】**
  - [ ] `ａ` → `a`
  - [ ] `ｂ` → `b`
  - [ ] `ｚ` → `z`
  - [ ] 全範囲のテスト
- [ ] 全角大文字アルファベット (`Ａ`-`Ｚ`) → 半角小文字 (`a`-`z`) (既存テストあり)
- [ ] 全角アルファベットの混在 (`ＡｂＣ`) → `abc`

### 5. エッジケース・境界値テスト

#### 単一文字のテスト
- [ ] 単一文字の正規化（各カテゴリから1つずつ）

#### 長い文字列
- [ ] 非常に長い文字列（1000文字以上）の正規化
- [ ] 長い文字列でのマッピング範囲の正確性

#### 特殊な文字列
- [ ] 濁点・半濁点が単独で存在する場合（結合できない場合）
  - [ ] `゛` (単独の濁点) → そのまま保持されるか
  - [ ] `゜` (単独の半濁点) → そのまま保持されるか
- [ ] 濁点・半濁点が結合できない文字の後に来る場合
  - [ ] `あ゛` → `あ` + `゛` (結合されない)
  - [ ] `あ゜` → `あ` + `゜` (結合されない)
- [ ] 半濁点がマッピングに存在しない文字の後に来る場合 **【カバレッジで未カバー】**
  - [ ] `か゜` → `か` + `゜` (結合されず、`return null` が実行される)

#### 複雑な混在パターン
- [ ] 全角・半角・濁点・記号が混在する複雑な文字列

### 6. convertNormalizedMatchToOriginal の不足テスト

#### 境界値テスト
- [ ] `start = 0, end = ranges.length` (最後の文字まで)
- [ ] `start = 0, end = 1` (最初の1文字)
- [ ] `start = ranges.length - 1, end = ranges.length` (最後の1文字)

#### エラーケース
- [ ] `start < 0` の場合
- [ ] `end > ranges.length` の場合
- [ ] `start > end` の場合（不正な範囲）
- [ ] `start = end` の場合（空の範囲）
- [ ] `startRange` が `undefined` の場合 **【カバレッジで未カバー】**
- [ ] `endRange` が `undefined` の場合 **【カバレッジで未カバー】**

#### 複雑なマッピング
- [ ] 複数の濁点結合を含むマッピング
  - [ ] `か゛は゛` → `がば` のマッピングで、`がば`全体を変換
- [ ] 全角→半角変換と濁点結合が混在するマッピング
- [ ] ブロック境界マーカーを含むマッピング

#### 部分的な範囲の変換
- [ ] 濁点結合の途中から始まる範囲
- [ ] 複数文字にまたがる範囲の変換

### 7. ブロック境界マーカーのテスト（不足）

- [ ] 複数のブロック境界マーカーが連続する場合
- [ ] ブロック境界マーカーと通常文字の混在
- [ ] ブロック境界マーカーを含む文字列のマッピング範囲

### 8. 統合テストケース

#### 実際の使用シナリオ
- [ ] 日本語文書の正規化（ひらがな・カタカナ・漢字・記号の混在）
- [ ] 英語と日本語の混在文書
- [ ] プログラミングコード風の文字列（記号が多い）
- [ ] URLやメールアドレスのような文字列

### 9. パフォーマンステスト（オプション）

- [ ] 大量の文字列を正規化した場合のパフォーマンス
- [ ] メモリリークの有無

## カバレッジレポートの分析結果

現在のカバレッジ（`normalization.ts`）:
- **Statements**: 83.44% (494/592)
- **Branches**: 93.24% (69/74) - **5つのブランチが未カバー**
- **Functions**: 100% (16/16)
- **Lines**: 83.44% (494/592)

### 未カバーのブランチ（5つ）

1. **全角小文字アルファベット** (`\uFF41-\uFF5A`) のブランチ（`normalizeFullWidthAlphabet`）
2. **全角カタカナ→半角カタカナ変換** (`normalizeFullWidthKatakana`) のブランチ - 関数全体が未カバー
3. **半濁点がマッピングに存在しない場合** (`combineWithDiacriticalMark` の return null)
4. **`convertNormalizedMatchToOriginal` の `startRange` が undefined の場合**
5. **`convertNormalizedMatchToOriginal` の `endRange` が undefined の場合**

## テストカバレッジの改善提案

### 優先度: 高（カバレッジで未カバー・実装上の問題も含む）
1. **全角小文字アルファベット** (`\uFF41-\uFF5A`) - **ブランチ未カバー** ⚠️ 実装は存在するがテストされていない
2. **全角カタカナ→半角カタカナ変換** (`normalizeFullWidthKatakana`) - **関数全体が未カバー（0%）** ⚠️ 実装上の問題: 到達不可能なコードの可能性
3. **半濁点がマッピングに存在しない場合のreturn null** - **ブランチ未カバー** ⚠️ エッジケース
4. **`convertNormalizedMatchToOriginal` の `startRange`/`endRange` が undefined の場合** - **ブランチ未カバー** ⚠️ エラーハンドリング

### 優先度: 高
1. 記号の正規化（すべての記号マッピング）
2. 濁点・半濁点の結合（すべてのマッピング）
3. エッジケース（濁点が結合できない場合など）
4. `convertNormalizedMatchToOriginal` の境界値・エラーケース

### 優先度: 中
1. 複雑な混在パターン

### 優先度: 低
1. 長い文字列のテスト
2. 統合テストケース
3. パフォーマンステスト
